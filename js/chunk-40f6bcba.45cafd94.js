(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-40f6bcba"],{"3ebe":function(t,e,i){},"70af":function(t,e,i){"use strict";i("3ebe")},"7db5":function(t,e,i){"use strict";i("a94b")},a94b:function(t,e,i){},b984:function(t,e,i){"use strict";i.r(e);var n=function(){var t,e,i,n=this,a=n._self._c;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:n.loading,expression:"loading"}],staticClass:"c-var p-achievement-detail"},[a("div",{staticClass:"m-main-box"},[a("div",{staticClass:"m-achievement-info"},[a("div",{staticClass:"m-sub-list"},n._l((null===(t=n.source)||void 0===t?void 0:t.SeriesAchievementList)||[],(function(t){return a("div",{key:t.ID,staticClass:"u-sub-achievement",on:{click:function(){return n.changeCurrent(t)}}},[a("img",{attrs:{src:n.iconUrl(t.IconID)}})])})),0),a("wiki-item",{attrs:{item:n.source}}),a("button",{staticClass:"m-confirm",class:{complete:n.isComplete,disabled:!n.isVirtual},on:{click:n.setConfirm}},[n._v(n._s(n.isComplete?"已完成":"设为已完成"))])],1),a("div",{staticClass:"m-wiki"},[a("div",{staticClass:"m-wiki-header"},[a("div",{staticClass:"u-title"},[n._v("成就攻略")]),a("div",{staticClass:"u-avatar-list"},n._l(n.authors,(function(t){return a("div",{key:t.user_id,staticClass:"u-avatar"},[a("img",{attrs:{src:n.showAvatar(t.user_avatar)}})])})),0),a("div",{staticClass:"u-time"},[n._v(" "+n._s(n.updated_at)+" ")])]),a("div",{staticClass:"m-content-box"},[a("Article",{attrs:{id:"wikiArticle",content:n.clearContent(null===(e=n.wiki_post)||void 0===e||null===(i=e.post)||void 0===i?void 0:i.content)}})],1),a("div",{staticClass:"u-show-log"},[n._v("查看历史修订")])])]),a("div",{staticClass:"m-comments"},[a("miniprogram-comment-list",{attrs:{"source-id":n.id,type:"achievement"}})],1),n.isFromTarget?n._e():a("suspend-common",{ref:"suspendCommon",staticClass:"u-suspend-common",staticStyle:{width:"100%"},attrs:{"btn-options":n.btnOptions,"drawer-options":n.drawerOptions},on:{search:n.onSearch},scopedSlots:n._u([{key:"default",fn:function(){return[a("div",{staticClass:"m-more-action"},[a("div",{staticClass:"u-action",on:{click:function(){return n.userSelectShow=!0}}},[a("svg",{attrs:{width:"25",height:"24",viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[a("path",{attrs:{d:"M17.5 12a2.25 2.25 0 012.25 2.25V15c0 2.956-2.79 6-7.5 6s-7.5-3.044-7.5-6v-.75A2.25 2.25 0 017 12h10.5zm-5.25-9.75a4.125 4.125 0 110 8.25 4.125 4.125 0 010-8.25z",fill:"#FEDAA3"}})])]),a("div",{staticClass:"u-action"},[a("svg",{attrs:{width:"25",height:"24",viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[a("circle",{attrs:{cx:"5.1",cy:"4.35",r:"1.35",fill:"#FEDAA3"}}),a("rect",{attrs:{x:"7.275",y:"3",width:"14.475",height:"2.7",rx:"1.35",fill:"#FEDAA3"}}),a("circle",{attrs:{cx:"5.1",cy:"9.45",r:"1.35",fill:"#FEDAA3"}}),a("rect",{attrs:{x:"7.275",y:"8.1",width:"14.475",height:"2.7",rx:"1.35",fill:"#FEDAA3"}}),a("circle",{attrs:{cx:"5.1",cy:"14.55",r:"1.35",fill:"#FEDAA3"}}),a("rect",{attrs:{x:"7.275",y:"13.2",width:"14.475",height:"2.7",rx:"1.35",fill:"#FEDAA3"}}),a("circle",{attrs:{cx:"5.1",cy:"19.65",fill:"#FEDAA3",r:"1.35"}}),a("rect",{attrs:{x:"7.275",y:"18.3",width:"14.475",height:"2.7",rx:"1.35",fill:"#FEDAA3"}})])]),a("div",{staticClass:"u-action"},[a("svg",{attrs:{width:"25",height:"24",viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[a("path",{attrs:{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M10.038 2.611a1.8 1.8 0 00-1.376 0l-4.9 2.028A1.8 1.8 0 002.65 6.3v13.052a1.8 1.8 0 002.489 1.664l4.212-1.743 5.112 2.115a1.8 1.8 0 001.375 0l4.9-2.028a1.8 1.8 0 001.112-1.66V4.646a1.8 1.8 0 00-2.488-1.663L15.15 4.726 10.038 2.61zM9.346 6a.9.9 0 01.9.9v7.8a.9.9 0 11-1.8 0V6.9a.9.9 0 01.9-.9zm6.708 3.3a.9.9 0 10-1.8 0v7.8a.9.9 0 101.8 0V9.3z",fill:"#FEDAA3"}})])])])]},proxy:!0}],null,!1,4257391053)}),a("user-select-drawer",{attrs:{visible:n.userSelectShow,"current-role":n.currentRole},on:{"update:visible":function(t){n.userSelectShow=t},change:n.setRole}}),a("confirm-ok-drawer",{attrs:{visible:n.conformShow},on:{"update:visible":function(t){n.conformShow=t},confirm:n.confirmOk}})],1)},a=[],s=i("5530"),o=i("c14f"),r=i("1da1"),c=(i("99af"),i("4de4"),i("a630"),i("caad"),i("a15b"),i("d81d"),i("14d9"),i("e9f5"),i("d866"),i("910d"),i("7d54"),i("ab43"),i("d3b7"),i("ac1f"),i("6062"),i("1e70"),i("79a4"),i("c1a1"),i("8b00"),i("a4e7"),i("1e5a"),i("72c3"),i("2532"),i("3ca3"),i("5319"),i("159b"),i("ddb0"),i("c1cc")),l=i("85e4"),u=i("9616"),d=i("262e"),m=i("500d"),h=i("16e5"),v=i("c9d2"),f=i("cc9a"),p=i("9a1b"),g=i("8975"),_=i("8718"),w=i("a974"),b=i("06da6"),y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-comment-list",attrs:{id:"macro-comment"}},[t._l(t.comments,(function(i){var n;return e("div",{key:i.id,staticClass:"m-comment-item"},[e("div",{staticClass:"m-main-content"},[e("div",{staticClass:"u-commenter-name",on:{click:function(e){return t.toDetail(i.user_id)}}},[t._v(" "+t._s(i.user_nickname)+" ")]),e("div",{staticClass:"u-comment-content"},[t._v(" "+t._s(i.content)+" ")]),e("div",{staticClass:"u-comment-time"},[t._v(" "+t._s(t.dayjs(null===i||void 0===i?void 0:i.commentDate).format("YYYY-MM-DD"))+" ")])]),null!==(n=i.children)&&void 0!==n&&n.length?e("div",{staticClass:"m-child-comment"},t._l(i.children,(function(i){return e("div",{key:i.id,staticClass:"m-reply-item"},[e("div",{staticClass:"u-replier-name",on:{click:function(e){return t.toDetail(i.user_id)}}},[t._v(" "+t._s(i.user_nickname)+" ")]),e("span",{staticClass:"u-reply"},[t._v("回复")]),e("div",{staticClass:"u-replier-name",on:{click:function(e){i.parent.user_id&&t.toDetail(i.parent.user_id)}}},[t._v(" "+t._s(i.parent.user_nickname)+" ")]),e("span",{staticClass:"u-reply"},[t._v("：")]),e("div",{staticClass:"u-reply-content"},[t._v(" "+t._s(i.content)+" ")])])})),0):t._e()])})),t.loading?e("div",{staticClass:"u-loading-more"},[t._v("加载中...")]):t._e(),t.noMoreData?e("div",{staticClass:"u-no-more"},[t._v("没有更多评论了")]):t._e()],2)},C=[],k=(i("b0c0"),i("5a0c")),A=i.n(k),S={name:"MiniprogramCommentList",props:["type","sourceId"],data:function(){return{comments:[],reply_form:{content:"",user_nickname:v["a"].getInfo().name},page:1,pageSize:10,total:0,loading:!1}},computed:{isWujie:function(){var t;return(null===(t=this.$route.name)||void 0===t?void 0:t.indexOf("wujie"))>-1},client:function(){return location.href.includes("classic")||location.href.includes("origin")?"origin":"std"},noMoreData:function(){return this.comments.length>=this.total&&this.total>0}},mounted:function(){this._onScroll=this.handleScroll.bind(this),window.addEventListener("scroll",this._onScroll)},beforeDestroy:function(){window.removeEventListener("scroll",this._onScroll)},methods:{dayjs:A.a,handleScroll:function(){if(!this.loading&&!this.noMoreData){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,e=window.innerHeight,i=document.documentElement.scrollHeight;t+e+100>=i&&this.loadMore()}},loadMore:function(){this.loading||this.noMoreData||(this.page++,this.get_comments(!0))},get_comments:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];function i(t,e){var n=[],a=function(){var a=t[s];if(!a)return 1;if(a.parent_id===e){var o=i(a.children,a.id);a.children=o.map((function(t){return t.parent={user_id:a.user_id,user_nickname:a.user_nickname,id:a.id},t.reply_form={show:!1,content:"",user_nickname:v["a"].getInfo().name},t})),n.push(a)}};for(var s in t)a();return n}this.type&&this.sourceId&&(this.loading=!0,m["b"].list({type:this.type,id:this.sourceId},{client:this.client,page:this.page}).then((function(n){n=n.data;for(var a=n.data.list,s=0;s<a.length;s++)a[s]["reply_form"]={show:!1,content:"",user_nickname:v["a"].getInfo().name};t.page=n.data.page,t.total=n.data.total,t.comments=e?t.comments.concat(i(a,0)):i(a,0),t.loading=!1})))},create_comment:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t.content){var n={type:this.type,source_id:String(this.sourceId),parent_id:i,user_nickname:t.user_nickname||v["a"].getInfo().name,content:t.content,client:this.client};m["b"].post(n).then((function(i){i=i.data,t.content="",e.$message({message:"提交成功，请等待审核",type:"success"})})).finally((function(){t.show=!1}))}else this.$message({message:"请先填写评论内容再尝试提交",type:"warning"})},handleCurrentChange:function(t){this.page=t,this.get_comments()},star_comment:function(t,e){var i=this;m["b"].star(t.id,{is_star:e}).then((function(){i.page=1,i.get_comments()}))},top_comment:function(t,e){var i=this;m["b"].top(t.id,{is_top:e}).then((function(){i.page=1,i.get_comments()}))},toDetail:function(){}},watch:{sourceId:{immediate:!0,handler:function(){this.page=1,this.get_comments()}}}},j=S,x=(i("7db5"),i("2877")),D=Object(x["a"])(j,y,C,!1,null,null,null),I=D.exports,E=i("2f3d"),O=i("3aef"),T={name:"CjMobileDetail",components:{ConfirmOkDrawer:O["a"],WikiItem:E["a"],MiniprogramCommentList:I,UserSelectDrawer:b["a"],SuspendCommon:c["a"],Article:w["a"]},data:function(){return{source:{},wiki_post:"",compatible:!1,is_empty:!0,imageCount:0,loadedImageCount:0,images:[],imagesLoaded:!1,userSelectShow:!1,currentRole:this.$store.state.role,loading:!1,conformShow:!1}},computed:{show:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}},id:function(){return this.$route.params.source_id},post_id:function(){return this.$route.params.post_id},isRevision:function(){return!!this.$route.params.post_id},author_id:function(){return~~this.wiki_post.post.user_id},client:function(){return this.$store.state.client},user_name:function(){var t,e;return null===(t=this.wiki_post)||void 0===t||null===(e=t.post)||void 0===e?void 0:e.user_nickname},updated_at:function(){var t,e;return Object(l["s"])(null===(t=this.wiki_post)||void 0===t||null===(e=t.post)||void 0===e?void 0:e.updated)},authors:function(){var t,e,i;return this.isRevision?[]:(null===(t=this.wiki_post)||void 0===t||null===(e=t.users)||void 0===e||null===(i=e.filter((function(t){return t.id})))||void 0===i?void 0:i.map((function(t){return{user_id:t.id,user_avatar:t.avatar,display_name:t.nickname}})))||[]},favTitle:function(){var t,e;return null===(t=this.wiki_post)||void 0===t||null===(e=t.source)||void 0===e?void 0:e.Name},prefix:function(){return"std"===this.client?"www":"origin"},isFromTarget:function(){return!1},drawerOptions:function(){return{hideType:["report"],direction:"btt"}},btnOptions:function(){return{showHome:!0,showIcon:!1,showMore:!0}},completeAchievements:function(){return this.$store.state.achievements||[]},achievementsVirtual:function(){return this.$store.state.achievementsVirtual||[]},isComplete:function(){return this.hadCompleted(this.id)},isVirtual:function(){var t;return!(null!==(t=this.currentRole)&&void 0!==t&&t.jx3id)}},watch:{id:{handler:function(){this.loadData()}},post_id:{handler:function(){this.loadRevision()}},currentRole:{deep:!0,handler:function(t){if(t){localStorage.setItem("wiki_last_sync",t.jx3id||0),this.$store.commit("SET_STATE",{key:"role",value:t});var e=t.jx3id;e?(this.$store.commit("SET_STATE",{key:"achievementsVirtual",value:[]}),this.loadRoleAchievements(e)):(0===e&&this.loadVirtualAchievements(),this.$store.commit("SET_STATE",{key:"achievements",value:[],isSession:!0}))}}}},methods:{iconUrl:_["a"],showAvatar:l["q"],icon_url:g["icon_url"],next:function(){},onSearch:function(){isMiniProgram()&&wx.miniProgram.navigateTo({url:"/pages/search/search-detail/search-detail?app=wiki&filter_category=成就"})},setRole:function(t){this.currentRole=t,this.userSelectShow=!1},openChild:function(){this.childrenShow=!0,console.log(111)},clearContent:function(t){return(t||"").replace(/ style="[^"]*"/g,"").replace(/<i?frame.*?src="(.*?)".*?>/g,(function(t,e){return'<a href="'.concat(e,'" target="_blank">').concat(e,"</a>")})).replace(/<i?frame.*?src="(.*?)".*?>.*?<\/i?frame>/g,(function(t,e){return'<a href="'.concat(e,'" target="_blank">').concat(e,"</a>")}))},publish_url:l["o"],triggerStat:function(){"origin"==this.client?Object(u["d"])("origin_cj",this.id):Object(u["d"])("cj",this.id)},changeCurrent:function(t){this.$router.push({name:"view",params:{source_id:t.ID}})},initImageLoader:function(){var t=this;this.$nextTick((function(){var e=document.getElementById("wikiArticle");if(e){var i=e.querySelectorAll("img");t.images=i,t.imageCount=i.length,0!==t.imageCount?t.preloadAllImages(i):t.setGlobalReady()}else t.setGlobalReady()}))},preloadAllImages:function(t){var e=this,i=0;Array.from(t).forEach((function(n,a){var s=n.src;if(n.complete)e.handleImageLoad();else{var o=new Image;o.onload=function(){i++,n.src=s,e.checkImageLoadCompletion(t,i)},o.onerror=function(){console.error("图片加载失败: ".concat(s)),n.src=s,e.handleImageLoad()},o.src=s}}))},checkImageLoadCompletion:function(t,e){var i=this;t.length!==this.loadedImageCount?setTimeout((function(){var e=Array.from(t).every((function(t){return t.complete}));(e||i.loadedImageCount===t.length)&&i.setGlobalReady()}),3e3):this.setGlobalReady()},handleImageLoad:function(){this.loadedImageCount++,this.loadedImageCount===this.imageCount&&this.setGlobalReady()},setGlobalReady:function(){this.imagesLoaded||(this.imagesLoaded=!0,window.__READY__=!0,console.log("全局状态设置成功: __READY__ = ",window.__READY__))},loadData:function(){var t=Object(r["a"])(Object(o["a"])().m((function t(){var e=this;return Object(o["a"])().w((function(t){while(1)switch(t.n){case 0:if(!this.id){t.n=2;break}return this.loading=!0,t.n=1,Object(d["p"])(this.id,{client:this.client}).then((function(t){var i,n;e.source=(null===t||void 0===t||null===(i=t.data)||void 0===i||null===(n=i.data)||void 0===n?void 0:n.achievement)||""}));case 1:return t.n=2,m["a"].mix({type:"achievement",id:this.id,client:this.client}).then((function(t){var i=t.post,n=t.source,a=t.compatible,s=t.isEmpty,o=t.users;e.wiki_post={post:i,source:n,users:o},e.is_empty=s,e.compatible=a,Object(h["b"])({caller:"cj_detail",data:{href:"".concat(e.prefix,":/cj/view/").concat(e.id)}}),v["a"].isLogin()&&Object(u["c"])({source_type:"origin"==e.client?"origin_cj":"cj",source_id:~~e.id,link:location.href,title:i.title})})).finally((function(){e.loading=!1}));case 2:this.isRobot&&this.initImageLoader(),this.triggerStat();case 3:return t.a(2)}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),loadRevision:function(){var t=this;m["a"].getById(this.post_id).then((function(e){var i;t.wiki_post=Object(s["a"])(Object(s["a"])({},t.wiki_post),{},{post:null===(i=e.data.data)||void 0===i?void 0:i.post})})),this.triggerStat()},ts2str:l["s"],loadConfig:function(){Object(f["b"])({key:"test_user_ua"}).then((function(t){var e=~~t.data.data.val;e&&Object(p["b"])()}))},loadRoleAchievements:function(t){var e=this;Object(d["m"])(t).then((function(t){var i,n,a,s,o=(null===(i=t.data)||void 0===i||null===(n=i.data)||void 0===n?void 0:n.achievements)||"",r=null===(a=t.data)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.jx3id;e.isSync=!!r;var c=o.split(",");e.$store.commit("SET_STATE",{key:"achievements",value:c,isSession:!0})}))},showSchoolIcon:l["r"],loadVirtualAchievements:function(){var t=this;this.currentRole&&!this.currentRole.jx3id&&Object(d["n"])().then((function(e){var i,n,a=(null===(i=e.data)||void 0===i||null===(n=i.data)||void 0===n?void 0:n.achievements)||"",s=a.split(",");t.$store.commit("SET_STATE",{key:"achievementsVirtual",value:s})}))},confirmOk:function(){this.finishVirtual([this.id])},hadCompleted:function(t){var e=this.isVirtual?this.achievementsVirtual:this.completeAchievements;return e.includes(t+"")},setConfirm:function(){this.isVirtual&&(this.isComplete?this.cancelVirtual([this.id]):this.conformShow=!0)},finishVirtual:function(t){var e=this,i=t||this.selectedAchievements.map((function(t){return t.ID+""})),n={achievements:i.join()};Object(d["s"])(n).then((function(t){e.$notify({title:"操作成功",message:"已将选中成就标记为已完成",type:"success"});var n=Array.from(new Set(e.achievementsVirtual.concat(i)));e.$store.commit("SET_STATE",{key:"achievementsVirtual",value:n}),e.isAll=!1,e.achievements=e.achievements.map((function(t){return Object(s["a"])(Object(s["a"])({},t),{},{checked:!1})}))}))},cancelVirtual:function(t){var e=this,i=t||this.selectedAchievements.map((function(t){return t.ID+""})),n={achievements:i.join()};Object(d["a"])(n).then((function(t){e.$notify({title:"操作成功",message:"已将选中成就标记为待完成",type:"success"});var n=e.achievementsVirtual.filter((function(t){return!i.includes(t)}));e.$store.commit("SET_STATE",{key:"achievementsVirtual",value:n}),e.isAll=!1,e.achievements=e.achievements.map((function(t){return Object(s["a"])(Object(s["a"])({},t),{},{checked:!1})}))}))}},mounted:function(){this.post_id?this.loadRevision():this.loadData(),this.loadConfig()}},R=T,V=(i("70af"),Object(x["a"])(R,n,a,!1,null,null,null));e["default"]=V.exports}}]);
//# sourceMappingURL=chunk-40f6bcba.45cafd94.js.map