(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-376e151a"],{"0636":function(t,e,i){t.exports=i.p+"img/tog_15.1f7bb44b.svg"},"0731":function(t,e,i){var s={"./Dark/jia.svg":"7bad","./Light/jia.svg":"e51b"};function n(t){var e=o(t);return i(e)}function o(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}n.keys=function(){return Object.keys(s)},n.resolve=o,t.exports=n,n.id="0731"},"07cb":function(t,e,i){t.exports=i.p+"img/tog_12.eb4b8e89.svg"},"08eb":function(t,e,i){"use strict";i("9a40")},"0a8a":function(t,e,i){t.exports=i.p+"img/tog_41.e54c1e63.svg"},"0c74":function(t,e,i){t.exports=i.p+"img/tog_9.63ff7127.svg"},"13d5":function(t,e,i){"use strict";var s=i("23e7"),n=i("d58f").left,o=i("a640"),r=i("1212"),a=i("9adc"),c=!a&&r>79&&r<83,l=c||!o("reduce");s({target:"Array",proto:!0,forced:l},{reduce:function(t){var e=arguments.length;return n(this,t,e,e>1?arguments[1]:void 0)}})},1450:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var s=i("41cb"),n=function(){return Object(s["f"])().get("api/team/my-game-roles?nopage&custom=0")}},"15d3":function(t,e,i){"use strict";i("be5e")},"1b89":function(t,e,i){t.exports=i.p+"img/tog_17.5c8b5a5e.svg"},2372:function(t,e,i){t.exports=i.p+"img/tog_7.d065990e.svg"},"2a83":function(t,e,i){"use strict";i("c0f0")},"33a5":function(t){t.exports=JSON.parse('{"0":"江湖","1":"天策","2":"万花","3":"纯阳","4":"七秀","5":"少林","6":"藏剑","7":"丐帮","8":"明教","9":"五毒","10":"唐门","18":"苍云","19":"长歌","20":"霸刀","21":"蓬莱","22":"凌雪","23":"衍天","24":"药宗","26":"刀宗","29":"万灵","38":"段氏","39":"无相"}')},3822:function(t,e,i){t.exports=i.p+"img/tog_4.ae3c48b4.svg"},3835:function(t,e,i){"use strict";function s(t){if(Array.isArray(t))return t}i.d(e,"a",(function(){return a}));i("a4d3"),i("e01a"),i("d28b"),i("14d9"),i("d3b7"),i("3ca3"),i("ddb0");function n(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var s,n,o,r,a=[],c=!0,l=!1;try{if(o=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;c=!1}else for(;!(c=(s=o.call(i)).done)&&(a.push(s.value),a.length!==e);c=!0);}catch(t){l=!0,n=t}finally{try{if(!c&&null!=i["return"]&&(r=i["return"](),Object(r)!==r))return}finally{if(l)throw n}}return a}}var o=i("06c5");i("d9e2");function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(t,e){return s(t)||n(t,e)||Object(o["a"])(t,e)||r()}},"3ba9":function(t,e,i){var s={"./Dark/comparison.svg":"c5bf","./Dark/count.svg":"ac83","./Dark/improvement.svg":"6886","./Dark/jia.svg":"7bad","./Dark/quan.svg":"d3fa","./Dark/right.svg":"fb970","./Dark/search.svg":"dfcb","./Dark/shaixuan.svg":"ea5b","./Dark/sum.svg":"7176","./Dark/tog_1.svg":"7a8e","./Dark/tog_10.svg":"852b","./Dark/tog_11.svg":"8029","./Dark/tog_12.svg":"984b","./Dark/tog_13.svg":"2cfb","./Dark/tog_15.svg":"9ca0","./Dark/tog_16.svg":"be26","./Dark/tog_17.svg":"0768","./Dark/tog_2.svg":"1aa3","./Dark/tog_3.svg":"bbdc","./Dark/tog_4.svg":"484b","./Dark/tog_40.svg":"fc87","./Dark/tog_41.svg":"27aa","./Dark/tog_5.svg":"d1be","./Dark/tog_6.svg":"2681","./Dark/tog_7.svg":"b4e8","./Dark/tog_8.svg":"d1e9","./Dark/tog_9.svg":"45e1","./Light/comparison.svg":"fb2b","./Light/count.svg":"8fe4","./Light/improvement.svg":"ac01","./Light/jia.svg":"e51b","./Light/quan.svg":"a8cd","./Light/right.svg":"5904","./Light/search.svg":"9bd5","./Light/shaixuan.svg":"a106","./Light/sum.svg":"f1ba","./Light/tog_1.svg":"680e","./Light/tog_10.svg":"88a5","./Light/tog_11.svg":"4828","./Light/tog_12.svg":"07cb","./Light/tog_13.svg":"f312","./Light/tog_15.svg":"0636","./Light/tog_16.svg":"d168","./Light/tog_17.svg":"1b89","./Light/tog_2.svg":"63ee","./Light/tog_3.svg":"8c41","./Light/tog_4.svg":"3822","./Light/tog_40.svg":"45f1","./Light/tog_41.svg":"0a8a","./Light/tog_5.svg":"a299","./Light/tog_6.svg":"9edd","./Light/tog_7.svg":"2372","./Light/tog_8.svg":"4ead","./Light/tog_9.svg":"0c74","./finish.svg":"11f9","./search_black.svg":"3a30","./unfinished.svg":"2b7a","./warning.svg":"5720"};function n(t){var e=o(t);return i(e)}function o(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}n.keys=function(){return Object.keys(s)},n.resolve=o,t.exports=n,n.id="3ba9"},"450f":function(t,e,i){var s={"./Dark/quan.svg":"d3fa","./Light/quan.svg":"a8cd"};function n(t){var e=o(t);return i(e)}function o(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}n.keys=function(){return Object.keys(s)},n.resolve=o,t.exports=n,n.id="450f"},"45f1":function(t,e,i){t.exports=i.p+"img/tog_40.8f4e8cc1.svg"},4828:function(t,e,i){t.exports=i.p+"img/tog_11.57cbcc0f.svg"},"4ead":function(t,e,i){t.exports=i.p+"img/tog_8.bc15415d.svg"},5720:function(t,e,i){t.exports=i.p+"img/warning.c59d3be8.svg"},5904:function(t,e,i){t.exports=i.p+"img/right.258873ca.svg"},"63ee":function(t,e,i){t.exports=i.p+"img/tog_2.6d3d6ed7.svg"},"680e":function(t,e,i){t.exports=i.p+"img/tog_1.93447118.svg"},6886:function(t,e,i){t.exports=i.p+"img/improvement.c17a031c.svg"},7176:function(t,e,i){t.exports=i.p+"img/sum.2d38a1fd.svg"},"7bad":function(t,e,i){t.exports=i.p+"img/jia.a4ed607e.svg"},"88a5":function(t,e,i){t.exports=i.p+"img/tog_10.4bea69ad.svg"},"8c41":function(t,e,i){t.exports=i.p+"img/tog_3.e4ec62c3.svg"},"8fe4":function(t,e,i){t.exports=i.p+"img/count.6033f8f4.svg"},"9a40":function(t,e,i){},"9edd":function(t,e,i){t.exports=i.p+"img/tog_6.19bcab65.svg"},a299:function(t,e,i){t.exports=i.p+"img/tog_5.b1775791.svg"},a8cd:function(t,e,i){t.exports=i.p+"img/quan.b9b6f7b4.svg"},ac01:function(t,e,i){t.exports=i.p+"img/improvement.5709fa8f.svg"},ac83:function(t,e,i){t.exports=i.p+"img/count.e9081d68.svg"},be5e:function(t,e,i){},c0f0:function(t,e,i){},c5bf:function(t,e,i){t.exports=i.p+"img/comparison.dfcc1cad.svg"},c740:function(t,e,i){"use strict";var s=i("23e7"),n=i("b727").findIndex,o=i("44d2"),r="findIndex",a=!0;r in[]&&Array(1)[r]((function(){a=!1})),s({target:"Array",proto:!0,forced:a},{findIndex:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),o(r)},c967:function(t,e,i){"use strict";i.d(e,"i",(function(){return n})),i.d(e,"e",(function(){return o})),i.d(e,"c",(function(){return r})),i.d(e,"d",(function(){return a})),i.d(e,"g",(function(){return c})),i.d(e,"a",(function(){return l})),i.d(e,"f",(function(){return u})),i.d(e,"k",(function(){return d})),i.d(e,"b",(function(){return v})),i.d(e,"h",(function(){return g})),i.d(e,"j",(function(){return f}));var s=i("41cb");function n(t){return Object(s["a"])().get("/api/cms/wiki/post/rank",{params:t})}function o(t,e){return Object(s["a"])().get("/api/cms/wiki/post/id/".concat(t),{params:e})}function r(t){return Object(s["a"])().get("/api/cms/user/kith/my")}function a(t){return Object(s["a"])().get("/api/cms/user/kith/game-roles/".concat(t))}function c(t){return Object(s["a"])().get("/api/cms/pvx/wiki_achievement_leap_schema",{params:t})}function l(t){return Object(s["a"])().post("/api/cms/pvx/wiki_achievement_leap_schema",t)}function u(t){return Object(s["a"])().get("/api/cms/pvx/wiki_achievement_leap_schema/".concat(t))}function d(t,e){return Object(s["a"])().put("/api/cms/pvx/wiki_achievement_leap_schema/".concat(t),e)}function v(t){return Object(s["a"])().delete("/api/cms/pvx/wiki_achievement_leap_schema/".concat(t))}function g(t){return Object(s["a"])().post("/api/cms/pvx/wiki_achievement_difficulty/list",t)}function f(t){return Object(s["a"])().post("/api/cms/qqbot/picture_task",t)}},d168:function(t,e,i){t.exports=i.p+"img/tog_16.7901e7f6.svg"},d3fa:function(t,e,i){t.exports=i.p+"img/quan.f7959a84.svg"},d58f:function(t,e,i){"use strict";var s=i("59ed"),n=i("7b0b"),o=i("44ad"),r=i("07fa"),a=TypeError,c="Reduce of empty array with no initial value",l=function(t){return function(e,i,l,u){var d=n(e),v=o(d),g=r(d);if(s(i),0===g&&l<2)throw new a(c);var f=t?g-1:0,h=t?-1:1;if(l<2)while(1){if(f in v){u=v[f],f+=h;break}if(f+=h,t?f<0:g<=f)throw new a(c)}for(;t?f>=0:g>f;f+=h)f in v&&(u=i(u,v[f],f,d));return u}};t.exports={left:l(!1),right:l(!0)}},e51b:function(t,e,i){t.exports=i.p+"img/jia.748a1596.svg"},f1ba:function(t,e,i){t.exports=i.p+"img/sum.a2f21be4.svg"},f312:function(t,e,i){t.exports=i.p+"img/tog_13.5711bcbb.svg"},fb2b:function(t,e,i){t.exports=i.p+"img/comparison.389bdb0c.svg"},fb970:function(t,e,i){t.exports=i.p+"img/right.b843a32f.svg"},fdd8:function(t,e,i){"use strict";i.r(e);i("b0c0"),i("4c53");var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"p-mini-leap"},[e("div",{ref:"infoTop",staticClass:"m-info-top"},[e("div",{staticClass:"m-avatar-list"},[t._m(0),t._l(t.compareRoles,(function(i,s){return e("div",{key:"role"+s,staticClass:"m-avatar-item",on:{click:function(e){return t.handleDeleteRole(i)}}},[e("RoleAvatar",{staticClass:"u-avatar-img",attrs:{mount:i.mount,body_type:i.body_type}}),e("div",{staticClass:"m-avatar-info"},[e("div",{staticClass:"u-avatar-name"},[t._v(t._s(i.name))]),e("div",{staticClass:"u-avatar-server"},[t._v(t._s(i.server))])])],1)})),t._l(3-t.compareRoles.length,(function(s){return e("div",{key:"add"+s,staticClass:"m-avatar-item m-avatar-item--add",on:{click:function(e){return t.addFriendRole(s)}}},[e("img",{staticClass:"u-avatar-add-quan",attrs:{src:i("450f")("./".concat(t.isDark?"Dark":"Light","/quan.svg")),"svg-inline":""}}),e("img",{staticClass:"u-avatar-add-icon",attrs:{src:i("0731")("./".concat(t.isDark?"Dark":"Light","/jia.svg")),"svg-inline":""}})])}))],2),e("div",{staticClass:"m-progress-section m-progress-section--total"},[e("div",{staticClass:"u-progress-label"},[t._v("总进度")]),t._l(t.compareRoles,(function(i,s){return e("div",{key:s,staticClass:"m-progress-value"},[e("div",{staticClass:"u-value-text"},[t._v(t._s(i.totalProgress))]),e("div",{staticClass:"u-percent-symbol"},[t._v("%")])])}))],2),e("div",{staticClass:"m-progress-section m-progress-section--achievement"},[e("div",{staticClass:"u-progress-label"},[t._v("成就数")]),t._l(t.compareRoles,(function(i,s){return e("div",{key:s,staticClass:"m-progress-value"},[e("span",{staticClass:"u-value-text"},[t._v(t._s(i.totalOwnAchievements))])])}))],2),e("div",{staticClass:"m-progress-section m-progress-section--seniority"},[e("div",{staticClass:"u-progress-label"},[t._v("总资历")]),t._l(t.compareRoles,(function(i,s){return e("div",{key:s,staticClass:"m-progress-value"},[e("span",{staticClass:"u-value-text w"},[t._v(t._s(t.setNumber(i.totalOwnPoints,"w")))]),e("span",{staticClass:"u-value-text"},[t._v(t._s(t.setNumber(i.totalOwnPoints)))])])}))],2),e("Search",{on:{submit:t.handleSearchClick}})],1),e("div",{staticClass:"m-category-section",style:{height:t.categoryHeight+"px"}},t._l(t.list,(function(i,s){return e("div",{key:s,staticClass:"m-category-card",on:{click:function(e){return t.handleCategoryClick(i)}}},[e("div",{staticClass:"m-category-box"},[e("div",{staticClass:"u-category-icon"},[e("img",{staticClass:"u-category-icon-img",attrs:{src:t.getIconPath(i.sub)}})]),e("div",{staticClass:"u-category-title"},[t._v(t._s(i.name))])]),t._l(i.roleAchievements,(function(i,s){return e("div",{key:s,staticClass:"m-category-box"},[e("span",{staticClass:"u-value-text"},[t._v(t._s(i.progress))]),e("span",{staticClass:"u-percent-symbol"},[t._v("%")])])}))],2)})),0),e("AddFriend",{attrs:{visible:t.drawerVisible},on:{"update:visible":function(e){t.drawerVisible=e},confirmSelection:t.handleConfirmSelection}}),e("DeleteRole",{attrs:{visible:t.delDrawerVisible,role:t.deleteRoleInfo},on:{"update:visible":function(e){t.delDrawerVisible=e},deleteRole:t.handleDeleteRoleConfirm}}),e("CataloguePop",{attrs:{visible:t.drawerCatalogueVisible,category:t.currentCategory,compareRoles:t.compareRoles},on:{"update:visible":function(e){t.drawerCatalogueVisible=e},handleDetailClick:t.handleDetailClick}})],1)},n=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-avatar-item"},[e("div",{staticClass:"u-avatar-placeholder"}),e("div",{staticClass:"m-avatar-info"},[e("div",{staticClass:"u-avatar-name"},[t._v("亲友对比")])])])}],o=i("5530"),r=i("c7eb"),a=i("1da1"),c=(i("99af"),i("7db0"),i("c740"),i("caad"),i("d81d"),i("14d9"),i("13d5"),i("fb6a"),i("a434"),i("e9c4"),i("b680"),i("b64b"),i("d3b7"),i("25f0"),i("2532"),i("159b"),function(){var t=this,e=t._self._c;return e("el-drawer",{staticClass:"c-role-list-drawer",attrs:{title:t.title,visible:t.drawerVisible,direction:"btt",size:"420px"},on:{close:t.handleClose}},[e("div",{staticClass:"role-list-wrapper"},[e("div",{ref:"roleListContainer",staticClass:"role-list-container"},[1==t.currentStep?e("div",{staticClass:"role-items"},t._l(t.step1Options,(function(i,s){return e("div",{key:s,staticClass:"role-item",class:{selected:t.selectCurrentStep==i.value},on:{click:function(e){return t.selectRoleType(i)}}},[e("div",{staticClass:"u-img"},[e("div",{staticClass:"role-name"},[t._v(t._s(i.name))])]),e("div",{staticClass:"role-info",domProps:{innerHTML:t._s("<".concat(i.info,">"))}})])})),0):t._e(),2==t.currentStep||4==t.currentStep?e("div",{staticClass:"role-items"},t._l(t.roles,(function(i,s){return e("div",{key:s,staticClass:"role-item",class:{selected:t.selectedRole&&t.selectedRole.jx3id==i.jx3id},on:{click:function(e){return t.selectRole(i)}}},[e("div",{staticClass:"u-img"},[e("RoleAvatar",{staticClass:"u-avatar-img",attrs:{mount:i.mount,body_type:i.body_type}}),e("div",{staticClass:"role-name"},[t._v(t._s(i.name))])],1),e("div",{staticClass:"role-info",domProps:{innerHTML:t._s("<".concat(i.server,">"))}})])})),0):t._e(),3==t.currentStep?e("div",{staticClass:"role-items"},t._l(t.friends,(function(i,s){var n;return e("div",{key:s,staticClass:"role-item",class:{selected:t.selectedFriend&&t.selectedFriend.kith_id==i.kith_id},on:{click:function(e){return t.selectFriend(i)}}},[e("div",{staticClass:"u-img"},[e("div",{staticClass:"role-name"},[t._v(t._s(null===(n=i.kith_info)||void 0===n?void 0:n.display_name))])]),e("div",{staticClass:"role-info",domProps:{innerHTML:t._s("<".concat("亲友UID"+i.kith_id,">"))}})])})),0):t._e()]),e("div",{staticClass:"role-button-group"},[e("div",{staticClass:"u-reset",on:{click:t.resetSelection}},[t._v("重置")]),e("div",{staticClass:"u-submit",on:{click:t.confirmSelection}},[t._v("确定")])]),t.showMask?e("div",{staticClass:"bottom-mask"}):t._e()])])}),l=[],u=i("c967"),d=i("85e4"),v=i("a01f"),g={name:"AddFriend",components:{RoleAvatar:v["a"]},props:{visible:{type:Boolean,default:!1}},computed:{drawerVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}},title:function(){return 1==this.currentStep?"选择角色":2==this.currentStep?"我的角色":"亲友的角色"}},data:function(){return{currentStep:1,selectCurrentStep:1,step1Options:[{name:"我的角色",value:2,info:"从我的角色里面进行选择"},{name:"亲友的角色",value:3,info:"从亲友的角色里面进行选择"}],roles:[],friends:[],selectedFriend:null,friendRoles:[],selectedRole:null,showMask:!1}},watch:{drawerVisible:function(t){var e=this;this.currentStep=1,this.selectCurrentStep=1,this.selectedRole=null,t?this.$nextTick((function(){e.$refs.roleListContainer&&(e.$refs.roleListContainer.addEventListener("scroll",e.checkScrollPosition),e.checkScrollPosition())})):this.removeScrollListener()}},beforeDestroy:function(){this.removeScrollListener()},created:function(){},methods:{showSchoolIcon:d["s"],removeScrollListener:function(){this.$refs.roleListContainer&&this.$refs.roleListContainer.removeEventListener("scroll",this.checkScrollPosition)},selectRoleType:function(t){this.selectCurrentStep=t.value},getSelfRoles:function(){try{this.roles=JSON.parse(sessionStorage.getItem("wiki_my_roles"))||[]}catch(t){console.error("获取自己的角色列表失败:",t),this.roles=[]}},getMyFriends:function(){var t=this;Object(u["c"])().then((function(e){t.friends=e.data.data}))},selectFriend:function(t){this.selectedFriend=t},getSelectedFriendRole:function(){var t=this;Object(u["d"])(this.selectedFriend.kith_id).then((function(e){0!==e.data.data.length?(t.currentStep=2,t.roles=e.data.data):t.$message("该亲友暂无同步游戏角色")}))},selectRole:function(t){this.selectedRole=t},resetSelection:function(){this.selectedRole=this.currentRole},confirmSelection:function(){switch(this.currentStep){case 1:if(1===this.selectCurrentStep)return void this.$message("请先选择一个角色类型");2===this.selectCurrentStep?this.getSelfRoles():3===this.selectCurrentStep&&this.getMyFriends(),this.currentStep=this.selectCurrentStep;break;case 2:null!==this.selectedRole&&(this.$emit("confirmSelection",this.selectedRole),this.drawerVisible=!1);break;case 3:this.getSelectedFriendRole();break}},handleClose:function(){this.drawerVisible=!1},checkScrollPosition:function(){if(this.$refs.roleListContainer){var t=this.$refs.roleListContainer,e=t.scrollHeight,i=t.clientHeight,s=t.scrollTop,n=e-(i+s);this.showMask=n>40}}}},f=g,h=(i("15d3"),i("2877")),m=Object(h["a"])(f,c,l,!1,null,null,null),p=m.exports,b=function(){var t=this,e=t._self._c;return e("el-drawer",{staticClass:"c-role-delete-drawer",attrs:{visible:t.visible,direction:"btt",size:"auto"},on:{close:t.handleClose}},[t.role&&1==t.step?e("div",{staticClass:"m-delete-role_first"},[e("RoleAvatar",{staticClass:"u-avatar-img",attrs:{mount:t.role.mount,body_type:t.role.body_type}}),e("div",{staticClass:"m-avatar-info"},[e("div",{staticClass:"u-avatar-name"},[t._v(t._s(t.role.name))]),e("div",{staticClass:"u-avatar-server"},[t._v(" "+t._s(t.xfName)+" · "+t._s(t.role.server)+" ")])]),e("div",{staticClass:"u-first-btn",on:{click:function(e){t.step=2}}},[t._v(" 删除角色 ")])],1):t._e(),2==t.step?e("div",{staticClass:"m-delete-role_second"},[e("img",{staticClass:"u-warning-icon",attrs:{width:"90",src:i("5720")}}),e("div",{staticClass:"u-tips"},[t._v("即将从对比中删除")]),e("div",{staticClass:"u-role-info"},[t._v(t._s(t.role.name)+"@"+t._s(t.role.server))]),e("div",{staticClass:"u-btns"},[e("div",{staticClass:"u-btn-item",on:{click:t.handleClose}},[t._v("取消")]),e("div",{staticClass:"u-btn-item",on:{click:t.handleDelete}},[t._v("确定")])])]):t._e()])},_=[],C=i("33a5"),k=i("65c2"),y={components:{RoleAvatar:v["a"]},props:{role:{type:Object,default:function(){}},visible:{type:Boolean,default:!1}},computed:{xfName:function(){return this.role.mount&&C[this.role.mount]||""},mpAvatar:function(){return this.role.mount?k["__cdn"]+"design/vector/school/".concat(this.role.mount,".svg"):null}},data:function(){return{step:1}},created:function(){},mounted:function(){},methods:{handleClose:function(){this.step=1,this.$emit("update:visible",!1)},handleDelete:function(){this.handleClose(),this.$emit("deleteRole",this.role)}}},w=y,x=(i("2a83"),Object(h["a"])(w,b,_,!1,null,null,null)),R=x.exports,D=i("fa1f"),S=i("0dee"),O=i("1450"),j=i("2ef0"),L=i("7720"),A=i("262e"),P={name:"Compare",components:{AddFriend:p,RoleAvatar:v["a"],DeleteRole:R,CataloguePop:D["a"],Search:S["a"]},data:function(){return{categoryHeight:0,drawerVisible:!1,roles:[],compareRoles:[],menuList:[],pointsData:{},compareAchievements:[],list:[],deleteRoleInfo:null,delDrawerVisible:!1,currentCategory:null,drawerCatalogueVisible:!1}},computed:{isDark:function(){var t=window.matchMedia("(prefers-color-scheme: dark)");return t.matches}},created:function(){document.title="亲友对比",this.init()},mounted:function(){this.categoryHeight=document.querySelector("body").offsetHeight-document.querySelector(".m-info-top").offsetHeight},methods:{init:function(){var t=this;return Object(a["a"])(Object(r["a"])().mark((function e(){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getPoints();case 2:return e.next=4,t.getMenuList();case 4:return e.next=6,t.getSelfRoles();case 6:return e.next=8,t.loadRoleAchievements(t.compareRoles[0].jx3id);case 8:case"end":return e.stop()}}),e)})))()},getIconPath:function(t){return i("3ba9")("./".concat(this.isDark?"Dark":"Light","/tog_").concat(t,".svg"))},setNumber:function(t,e){if(!t)return"";var i=t.toString();return"w"==e?i.length>4?i.slice(0,-4):"":i.length>4?i.slice(-4):i},getSelfRoles:function(){try{if(this.roles=JSON.parse(sessionStorage.getItem("wiki_my_roles"))||[],0==this.roles.length)this.getUserRoles();else{var t=sessionStorage.getItem("wiki_last_sync");if(this.roles.length>0&&t){var e=this.roles.find((function(e){return e.jx3id==t}));e&&this.compareRoles.push(e)}}}catch(i){console.error("获取自己的角色列表失败:",i),this.roles=[],this.getUserRoles()}},getUserRoles:function(){var t=this;Object(O["a"])().then((function(e){var i,s;t.roles=(null===(i=e.data)||void 0===i||null===(s=i.data)||void 0===s?void 0:s.list)||[],t.compareRoles.push(t.roles[0]),sessionStorage.setItem("wiki_my_roles",JSON.stringify(t.roles||[]))}))},addFriendRole:function(t){console.log("添加对比角色:",t),this.drawerVisible=!0},handleConfirmSelection:function(t){this.compareRoles.find((function(e){return e.jx3id==t.jx3id}))?this.$message({message:"已添加该角色",type:"warning"}):(this.compareRoles.push(t),this.loadRoleAchievements(t.jx3id),this.drawerVisible=!1)},handleDeleteRole:function(t){1!=this.compareRoles.length?(console.log(this.list),this.deleteRoleInfo=t,this.delDrawerVisible=!0):this.$message({message:"至少保留一个角色",type:"warning"})},handleDeleteRoleConfirm:function(){var t=this,e=this.compareRoles.findIndex((function(e){return e.jx3id==t.deleteRoleInfo.jx3id}));-1!=e&&(this.compareRoles.splice(e,1),this.list=this.list.map((function(t){return t.roleAchievements.splice(e,1),t}))),this.delDrawerVisible=!1},handleCategoryClick:function(t){this.currentCategory=t,this.drawerCatalogueVisible=!0},handleDetailClick:function(){this.drawerCatalogueVisible=!1,sessionStorage.setItem("compare_roles",JSON.stringify(this.compareRoles||[])),sessionStorage.setItem("compare_category",JSON.stringify(this.currentCategory||{})),Object(L["b"])(this.$router.resolve({name:"compare/catalogue",query:{}}).href)},handleSearchClick:function(){Object(L["b"])(this.$router.resolve({name:"compare/achievement",query:{source:1}}).href)},getPoints:function(){var t=this;return Object(A["b"])().then((function(e){var i=e.data.data.points;sessionStorage.setItem("points_data",JSON.stringify(i||{})),t.pointsData=i}))},getMenuList:function(){var t=this;Object(A["i"])({general:1,client:this.$store.state.client}).then((function(e){var i=e.data.data.menus;t.menuList=i}))},loadRoleAchievements:function(t){var e=this;Object(A["m"])(t).then((function(i){var s,n,o=(null===(s=i.data)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.achievements)||"",r=o.split(",");e.compareAchievements=r,e.getRenderList(e.menuList,t)}))},getRenderList:function(t,e){var i=this,s=this.compareRoles.findIndex((function(t){return t.jx3id==e}));this.compareRoles[s].finishAchievements=this.compareAchievements;var n=Object.keys(t).map((function(s){var n=t[s],o=i.getAllAchievementsData(n),r=[];return r.push({jx3id:e,allAchievements:o.allAchievements,ownAchievements:o.ownAchievements,ownPoints:o.ownPoints,progress:(o.ownPoints/o.allPoints*100).toFixed(2)}),{sub:n.sub,detail:n.detail,name:n.name,children:n.children,allPoints:o.allPoints,roleAchievements:r}}));this.list.length>0?this.list=Object(j["cloneDeep"])(this.list).map((function(t,e){return Object(o["a"])(Object(o["a"])({},t),{},{roleAchievements:t.roleAchievements.concat(n[e].roleAchievements)})})):this.list=n;var r=0;n.forEach((function(t){r+=t.roleAchievements[0].ownAchievements.length})),this.compareRoles[s].totalOwnAchievements=r,this.compareRoles[s].totalAllPoints=n.reduce((function(t,e){return t+e.allPoints}),0),this.compareRoles[s].totalOwnPoints=this.compareAchievements.reduce((function(t,e){return t+(i.pointsData[e]||0)}),0),this.compareRoles[s].totalProgress=(this.compareRoles[s].totalOwnPoints/this.compareRoles[s].totalAllPoints*100).toFixed(2)},getAllAchievementsData:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{allPoints:0,ownPoints:0},o=this.compareAchievements;return t.achievements.forEach((function(t){Array.isArray(t)?t.forEach((function(t){e.pointsData[t]&&(n.allPoints+=e.pointsData[t],i.push(t),o.includes(String(t))&&(n.ownPoints+=e.pointsData[t],s.push(t)))})):e.pointsData[t]&&(n.allPoints+=e.pointsData[t],i.push(t),o.includes(String(t))&&(n.ownPoints+=e.pointsData[t],s.push(t)))})),t.children&&t.children.forEach((function(t){e.getAllAchievementsData(t,i,s,n)})),{allAchievements:i,allPoints:n.allPoints,ownAchievements:s,ownPoints:n.ownPoints}}}},I=P,F=(i("08eb"),Object(h["a"])(I,s,n,!1,null,"1dd0b5a9",null));e["default"]=F.exports}}]);