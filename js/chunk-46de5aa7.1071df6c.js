(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-46de5aa7"],{"061b":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-drawer",{staticStyle:{width:"100%"},attrs:{visible:e.show,direction:"btt","show-close":!1,"with-header":!1,"append-to-body":"","custom-class":"topic-view-drawer",size:"400"},on:{"update:visible":function(t){e.show=t},close:e.onClose},scopedSlots:e._u([{key:"default",fn:function(){var a,i;return[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"c-var m-topic-view"},[e.source?t("div",{staticClass:"m-achievement-info"},[t("div",{staticClass:"m-left"},[t("div",{staticClass:"u-achievement-box"},[t("div",{staticClass:"u-icon"},[t("img",{attrs:{src:e.icon_url(e.source.IconID)},on:{"~error":function(t){return function(){t.target.src=e.icon_url()}.apply(null,arguments)}}})]),t("div",{staticClass:"u-name"},[e._v(" "+e._s(e.source.Name)+" ")])]),t("div",{staticClass:"u-topic-other"},[t("div",{staticClass:"u-avatar-list"},e._l(e.authors,(function(a){return t("div",{key:a.user_id,staticClass:"u-avatar"},[t("img",{attrs:{src:e.showAvatar(a.user_avatar)}})])})),0),t("div",{staticClass:"u-time"},[e._v(" "+e._s(e.updated_at)+" ")])])]),t("div",{staticClass:"m-right"})]):e._e(),t("div",{ref:"content",staticClass:"m-content-box",class:{"not-on-bottom":!e.isAtBottom},on:{contextmenu:e.openChild}},[t("Article",{attrs:{id:"wikiArticle",content:e.clearContent(null===(a=e.wiki_post)||void 0===a||null===(i=a.post)||void 0===i?void 0:i.content)}})],1)])]},proxy:!0}])})],1)},n=[],r=a("5530"),s=a("c7eb"),c=a("1da1"),o=(a("99af"),a("4de4"),a("a630"),a("caad"),a("a15b"),a("d81d"),a("d3b7"),a("ac1f"),a("6062"),a("1e70"),a("79a4"),a("c1a1"),a("8b00"),a("a4e7"),a("1e5a"),a("72c3"),a("2532"),a("3ca3"),a("5319"),a("159b"),a("ddb0"),a("2ef0")),u=a("8975"),l=a("85e4"),d=a("9616"),h=a("262e"),m=a("500d"),f=a("16e5"),v=a("c9d2"),p=a("cc9a"),b=a("9a1b"),g=a("a974"),_=a("7720"),y={name:"WikiViewDrawer",components:{Article:g["a"]},emits:["update:visible","update:current"],props:{visible:{type:Boolean,default:!1},current:{type:Object,default:function(){return{}}}},data:function(){return{tmpVal:null,confirmShow:!1,childrenShow:!1,source:null,wiki_post:null,compatible:!1,is_empty:!0,loading:!1,imageCount:0,loadedImageCount:0,images:[],imagesLoaded:!1,nextFunc:null,isAtBottom:!1}},watch:{current:{handler:function(){},immediate:!0,deep:!0},id:{handler:function(){this.loadData()}},post_id:{handler:function(){this.loadRevision()}},visible:{handler:function(e){var t=this;if(e)this.$nextTick((function(){var e=t.$refs.content;e&&(e.addEventListener("scroll",t.handleScroll),t.handleScroll({target:e}))}));else{var a=this.$refs.content;a&&a.removeEventListener("scroll",this.handleScroll)}},immediate:!0}},computed:{show:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}},id:function(){var e;return null===(e=this.current)||void 0===e?void 0:e.ID},post_id:function(){return this.$route.params.post_id},isRevision:function(){return!!this.$route.params.post_id},author_id:function(){return~~this.wiki_post.post.user_id},client:function(){return this.$store.state.client},user_name:function(){var e,t;return null===(e=this.wiki_post)||void 0===e||null===(t=e.post)||void 0===t?void 0:t.user_nickname},updated_at:function(){var e,t;return Object(l["t"])(null===(e=this.wiki_post)||void 0===e||null===(t=e.post)||void 0===t?void 0:t.updated)},authors:function(){var e,t,a;return this.isRevision?[]:(null===(e=this.wiki_post)||void 0===e||null===(t=e.users)||void 0===t||null===(a=t.filter((function(e){return e.id})))||void 0===a?void 0:a.map((function(e){return{user_id:e.id,user_avatar:e.avatar,display_name:e.nickname}})))||[]},favTitle:function(){var e,t;return null===(e=this.wiki_post)||void 0===e||null===(t=e.source)||void 0===t?void 0:t.Name},prefix:function(){return"std"===this.client?"www":"origin"},isFromTarget:function(){return!1},drawerOptions:function(){return{hideType:["report"],direction:"btt"}},btnOptions:function(){return{showHome:!0,showIcon:!1,showMore:!0}},isVirtual:function(){var e;return!(null!==(e=this.currentRole)&&void 0!==e&&e.jx3id)},currentRole:function(){return this.$store.state.role},isComplete:function(){return this.hadCompleted(this.id)},completeAchievements:function(){return this.$store.state.achievements||[]},achievementsVirtual:function(){return this.$store.state.achievementsVirtual||[]}},mounted:function(){this.post_id?this.loadRevision():this.loadData(),this.loadConfig()},methods:{showAvatar:l["r"],icon_url:u["icon_url"],next:function(){},hadCompleted:function(e){var t=this.isVirtual?this.achievementsVirtual:this.completeAchievements;return t.includes(e+"")},openChild:function(){this.childrenShow=!0},changeCurrent:function(e){this.$emit("update:current",e)},clearContent:function(e){return(e||"").replace(/ style="[^"]*"/g,"").replace(/<i?frame.*?src="(.*?)".*?>/g,(function(e,t){return'<a href="'.concat(t,'" target="_blank">').concat(t,"</a>")})).replace(/<i?frame.*?src="(.*?)".*?>.*?<\/i?frame>/g,(function(e,t){return'<a href="'.concat(t,'" target="_blank">').concat(t,"</a>")}))},publish_url:l["p"],triggerStat:function(){"origin"==this.client?Object(d["d"])("origin_cj",this.id):Object(d["d"])("cj",this.id)},initImageLoader:function(){var e=this;this.$nextTick((function(){var t=document.getElementById("wikiArticle");if(t){var a=t.querySelectorAll("img");e.images=a,e.imageCount=a.length,0!==e.imageCount?e.preloadAllImages(a):e.setGlobalReady()}else e.setGlobalReady()}))},preloadAllImages:function(e){var t=this,a=0;Array.from(e).forEach((function(i,n){var r=i.src;if(i.complete)t.handleImageLoad();else{var s=new Image;s.onload=function(){a++,i.src=r,t.checkImageLoadCompletion(e,a)},s.onerror=function(){console.error("图片加载失败: ".concat(r)),i.src=r,t.handleImageLoad()},s.src=r}}))},checkImageLoadCompletion:function(e,t){var a=this;e.length!==this.loadedImageCount?setTimeout((function(){var t=Array.from(e).every((function(e){return e.complete}));(t||a.loadedImageCount===e.length)&&a.setGlobalReady()}),3e3):this.setGlobalReady()},handleImageLoad:function(){this.loadedImageCount++,this.loadedImageCount===this.imageCount&&this.setGlobalReady()},setGlobalReady:function(){this.imagesLoaded||(this.imagesLoaded=!0,window.__READY__=!0,console.log("全局状态设置成功: __READY__ = ",window.__READY__))},loadData:function(){var e=Object(c["a"])(Object(s["a"])().mark((function e(){var t=this;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.id){e.next=6;break}return this.loading=!0,e.next=4,Object(h["p"])(this.id,{client:this.client}).then((function(e){var a,i;t.source=(null===e||void 0===e||null===(a=e.data)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.achievement)||""}));case 4:return e.next=6,m["a"].mix({type:"achievement",id:this.id,client:this.client}).then((function(e){var a=e.post,i=e.source,n=e.compatible,r=e.isEmpty,s=e.users;t.wiki_post={post:a,source:i,users:s},t.is_empty=r,t.compatible=n,Object(f["b"])({caller:"cj_detail",data:{href:"".concat(t.prefix,":/cj/view/").concat(t.id)}}),v["a"].isLogin()&&Object(d["c"])({source_type:"origin"==t.client?"origin_cj":"cj",source_id:~~t.id,link:location.href,title:a.title})})).finally((function(){t.loading=!1}));case 6:this.isRobot&&this.initImageLoader(),this.triggerStat();case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),loadRevision:function(){var e=this;m["a"].getById(this.post_id).then((function(t){var a;e.wiki_post=Object(r["a"])(Object(r["a"])({},e.wiki_post),{},{post:null===(a=t.data.data)||void 0===a?void 0:a.post})})),this.triggerStat()},ts2str:l["t"],loadConfig:function(){Object(p["b"])({key:"test_user_ua"}).then((function(e){var t=~~e.data.data.val;t&&Object(b["b"])()}))},setConfirm:function(){this.isVirtual&&(this.isComplete?this.cancelVirtual([this.id]):this.confirmShow=!0)},onClose:function(){this.show=!1},resetSearch:function(){this.tmpVal=Object(o["pick"])(this.tmpVal)},changeValue:function(){this.$emit("change",this.tmpVal)},toDetail:function(){Object(_["b"])(this.$router.resolve({name:"view",params:{post_id:this.post_id,source_id:this.id}}).href)},handleScroll:function(e){var t=e.target,a=5;this.isAtBottom=t.scrollTop+t.clientHeight>=t.scrollHeight-a},confirmOk:function(){this.finishVirtual([this.id])},finishVirtual:function(e){var t=this,a=e||this.selectedAchievements.map((function(e){return e.ID+""})),i={achievements:a.join()};Object(h["s"])(i).then((function(e){t.$notify({title:"操作成功",message:"已将选中成就标记为已完成",type:"success"});var i=Array.from(new Set(t.achievementsVirtual.concat(a)));t.$store.commit("SET_STATE",{key:"achievementsVirtual",value:i}),t.isAll=!1,t.achievements=t.achievements.map((function(e){return Object(r["a"])(Object(r["a"])({},e),{},{checked:!1})}))}))},cancelVirtual:function(e){var t=this,a=e||this.selectedAchievements.map((function(e){return e.ID+""})),i={achievements:a.join()};Object(h["a"])(i).then((function(e){t.$notify({title:"操作成功",message:"已将选中成就标记为待完成",type:"success"});var i=t.achievementsVirtual.filter((function(e){return!a.includes(e)}));t.$store.commit("SET_STATE",{key:"achievementsVirtual",value:i}),t.isAll=!1,t.achievements=t.achievements.map((function(e){return Object(r["a"])(Object(r["a"])({},e),{},{checked:!1})}))}))}}},C=y,w=(a("e7d5"),a("2877")),k=Object(w["a"])(C,i,n,!1,null,null,null);t["a"]=k.exports},"38cf":function(e,t,a){"use strict";var i=a("23e7"),n=a("1148");i({target:"String",proto:!0},{repeat:n})},"5c62":function(e,t,a){"use strict";a("6c62")},"6c62":function(e,t,a){},"83f1":function(e,t,a){},8718:function(e,t,a){"use strict";a("99af");var i=a("01ea");t["a"]=function(e){return isNaN(parseInt(e))?"".concat(i["e"],"image/common/nullicon.png"):"".concat(i["d"],"icon/").concat(e,".png")}},8975:function(e,t,a){"use strict";a.r(t),a.d(t,"date_format",(function(){return i})),a.d(t,"description",(function(){return n})),a.d(t,"icon_url",(function(){return r["a"]})),a.d(t,"item_color",(function(){return s})),a.d(t,"item_attribute_percent",(function(){return c})),a.d(t,"item_bind",(function(){return o})),a.d(t,"item_price",(function(){return u})),a.d(t,"item_quality",(function(){return d})),a.d(t,"item_require_1_type",(function(){return l})),a.d(t,"star",(function(){return h})),a.d(t,"author_url",(function(){return f}));a("99af");var i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{polished:!0,separator:"-"},a=new Date(1e3*parseInt(e)),i=a.getFullYear(),n=a.getMonth()+1,r=a.getDate(),s=t.polished?"".concat(i).concat(t.separator).concat(c(n)).concat(t.separator).concat(c(r)):"".concat(i).concat(t.separator).concat(n).concat(t.separator).concat(r);return s;function c(e){return e<10?"0"+e:e}},n=(a("ac1f"),a("5319"),function(e){return e||""}),r=a("8718"),s=function(e){switch(e){case 0:return"rgb(167,167,167)";case 1:return"rgb(255,255,255)";case 2:return"rgb(0,210,75)";case 3:return"rgb(0,126,255)";case 4:return"rgb(254,45,254)";case 5:return"rgb(255,165,0)";default:return"rgb(0,0,0)"}},c=(a("b680"),function(e,t){var a="";switch(t=t?parseInt(t):0,e){case"atAllTypeCriticalStrike":case"atLunarCriticalStrike":case"atMagicCriticalStrike":case"atNeutralCriticalStrike":case"atPhysicsCriticalStrike":case"atPoisonCriticalStrike":case"atSolarAndLunarCriticalStrike":case"atSolarCriticalStrike":a="+".concat((t/35737.5*100).toFixed(2),"%");break;case"atAllTypeCriticalDamagePowerBase":case"atLunarCriticalDamagePowerBase":case"atMagicCriticalDamagePowerBase":case"atNeutralCriticalDamagePowerBase":case"atPhysicsCriticalDamagePowerBase":case"atPoisonCriticalDamagePowerBase":case"atSolarAndLunarCriticalDamagePowerBase":case"atSolarCriticalDamagePowerBase":a="+".concat((t/12506.25*100).toFixed(2),"%");break;case"atToughnessBase":a="+".concat((t/35737.5*100).toFixed(2),"% +").concat((t/9588.75*100).toFixed(2),"%会心减害");break;case"atDecriticalDamagePowerBase":a="";break;case"atAllTypeHitValue":case"atLunarHitValue":case"atMagicHitValue":case"atNeutralHitValue":case"atPhysicsHitValue":case"atPoisonHitValue":case"atSolarAndLunarHitValue":case"atSolarHitValue":a="+".concat((t/25991.25*100).toFixed(2),"%");break;case"atDodge":a="";break;case"atParryBase":a="";break;case"atStrainBase":a="+".concat((t/34458.75*100).toFixed(2),"%");break;case"atPhysicsDefenceAdd":case"atPhysicsShieldAdditional":case"atPhysicsShieldBase":a="";break;case"atLunarMagicShieldBase":case"atMagicShield":case"atNeutralMagicShieldBase":case"atPoisonMagicShieldBase":case"atSolarMagicShieldBase":a="";break;case"atLunarOvercomeBase":case"atMagicOvercome":case"atNeutralOvercomeBase":case"atPhysicsOvercomeBase":case"atPoisonOvercomeBase":case"atSolarAndLunarOvercomeBase":case"atSolarOvercomeBase":a="+".concat((t/35737.5*100).toFixed(2),"%");break;case"atHasteBase":a="+".concat((t/43856.25*100).toFixed(2),"%");break;default:break}return a?" (".concat(a,")"):""}),o=function(e){switch(e){case 1:return"可交易";case 2:return"装备前可交易";case 3:return"不可交易";default:return"未知绑定类型"}},u=function(e){var t=parseInt(e/100/100/1e4),a=parseInt(e/100/100%1e4),i=parseInt(e/100%100),n=parseInt(e%100),r="";return t&&(r+=t+"砖"),a&&(r+=a+"金"),i&&(r+=i+"银"),r+=n+"铜",r},l=function(e){return 5===e?"需要等级":e},d=function(e){switch(e){case 0:return"破败";case 1:return"普通";case 2:return"精巧";case 3:return"卓越";case 4:return"珍奇";case 5:return"稀世";default:return"未知"}},h=(a("38cf"),function(e){return"⭐️".repeat(e||1)}),m=a("85e4"),f=function(e){return Object(m["a"])(e)}},"9a1b":function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return r}));var i=a("41cb");function n(){return Object(i["a"])().get("/api/cms/user/my/info").then((function(e){return e.data.data}))}function r(e){return Object(i["a"])().post("/api/cms/system/common/reporter")}},af2d:function(e,t,a){"use strict";a.r(t);a("b0c0");var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"p-mini-leap_achievement"},[t("div",{ref:"infoTop",staticClass:"m-info-top"},[t("div",{staticClass:"m-avatar-list"},[t("div",{staticClass:"m-avatar-item",on:{click:e.handleClickCategory}},[t("div",{staticClass:"m-avatar-info"},[t("div",{staticClass:"u-avatar-name u-category-name"},e._l(e.setCategoryName,(function(a,i){return t("div",{key:i},[e._v(e._s(a))])})),0)])]),e._l(e.compareRoles,(function(a,i){return t("div",{key:"role_"+i,staticClass:"m-avatar-item"},[t("RoleAvatar",{staticClass:"u-avatar-img",attrs:{mount:a.mount,body_type:a.body_type}}),t("div",{staticClass:"m-avatar-info"},[t("div",{staticClass:"u-avatar-name"},[e._v(e._s(a.name))]),t("div",{staticClass:"u-avatar-server"},[e._v(e._s(a.server))])])],1)})),e._l(3-e.compareRoles.length,(function(e){return t("div",{key:"add_"+e,staticClass:"m-avatar-item m-avatar-item--add"})}))],2),t("Search",{ref:"searchRef",attrs:{showFilter:!0,roles:e.compareRoles},on:{filterSubmit:e.handleFilterSubmit,submit:e.handleSearchClick}})],1),t("div",{staticClass:"m-category-section",style:{height:e.categoryHeight+"px","padding-bottom":e.isModeEnabled?"90px":"0px"}},e._l(e.list,(function(i,n){return t("div",{key:"category_"+n,staticClass:"m-category-card"},[t("div",{staticClass:"m-category-box",on:{click:function(t){return e.handleClickCategory(i)}}},[t("img",{staticClass:"u-category-icon-img",attrs:{src:e.iconLink(null===i||void 0===i?void 0:i.IconID)}}),t("div",{staticClass:"u-category-title"},[e._v(e._s(i.Name))])]),e._l(i.roles,(function(e,i){return t("div",{key:i,staticClass:"m-category-box"},[t("img",e?{staticClass:"u-icon",attrs:{src:a("11f9")}}:{staticClass:"u-icon",attrs:{src:a("2b7a")}})])}))],2)})),0),e.isModeEnabled?t("div",{staticClass:"u-mode"},[t("div",{staticClass:"u-mode-item"},[e._v(" 仅显示"+e._s(e.isModeName)+"的成就 ")])]):e._e(),t("CataloguePop",{attrs:{visible:e.drawerCatalogueVisible,category:e.currentCategory,compareRoles:e.compareRoles,showDetailBtn:!1},on:{"update:visible":function(t){e.drawerCatalogueVisible=t}}}),e.achievementDetailVisible?t("achievement_detail",{ref:"achievementDetail",attrs:{visible:e.achievementDetailVisible,current:e.current},on:{"update:visible":function(t){e.achievementDetailVisible=t},"update:current":function(t){e.current=t}}}):e._e()],1)},n=[],r=a("c7eb"),s=a("1da1"),c=(a("4de4"),a("7db0"),a("c740"),a("caad"),a("d81d"),a("14d9"),a("b64b"),a("d3b7"),a("2532"),a("3ca3"),a("4c53"),a("159b"),a("ddb0"),a("138d")),o=a("fa1f"),u=a("061b"),l=a("a01f"),d=a("0dee"),h=a("2ef0"),m=a("85e4"),f=a("262e"),v={name:"CompareCatalogue",components:{RoleAvatar:l["a"],CataloguePop:o["a"],Search:d["a"],achievement_detail:u["a"]},data:function(){return{loading:!1,categoryHeight:0,roles:[],compareRoles:[],pointsData:{},list:[],list_bak:[],category:null,currentCategory:null,drawerCatalogueVisible:!1,isSearchEnabled:!1,achievementDetailVisible:!1,current:null,isModeEnabled:!1,isModeName:""}},computed:{isDark:function(){var e=window.matchMedia("(prefers-color-scheme: dark)");return e.matches},setCategoryName:function(){var e;if(this.isSearchEnabled)return[];var t=(null===(e=this.category)||void 0===e?void 0:e.name)||null;return t&&t.split("-")||[]}},created:function(){document.title="亲友对比",this.init()},methods:{iconLink:m["l"],handleClickCategory:function(e){this.current=Object(h["cloneDeep"])(e),this.achievementDetailVisible=!0},handleFilterSubmit:function(e){if(!e.filterId)return this.isModeEnabled=!1,void(this.list=Object(h["cloneDeep"])(this.list_bak));this.isModeEnabled=!0,this.isModeName=e.filterLabel;var t=e.filterId.split("_"),a=this.compareRoles.findIndex((function(e){return e.jx3id==t[0]}));"completed"==t[1]?this.list=this.list_bak.filter((function(e){return e.roles[a]})):this.list=this.list_bak.filter((function(e){return!e.roles[a]}))},handleSearchClick:function(e){this.isSearchEnabled=!0,this.handleRoleAchievements(e.data)},init:function(){var e=this;return Object(s["a"])(Object(r["a"])().mark((function t(){var a,i,n,o,u,l;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,a=e.$route.query.roles.split(","),i=e.$route.query.sub,n=e.$route.query.detail,t.next=4,Object(c["b"])(e.$store.state.client);case 4:return o=t.sent,u=o.menuList||[],e.pointsData=o.pointsList||[],t.next=9,Promise.all(a.map(function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(t){var a,i;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.split("|"),e.next=3,Object(c["c"])(a[0]);case 3:return i=e.sent,e.abrupt("return",{jx3id:a[0],server:a[1],mount:a[2],body_type:a[3],name:a[4],finishedAchievements:i.list||[]});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 9:if(l=t.sent,e.compareRoles=l,1!=e.$route.query.source){t.next=15;break}e.$refs.searchRef.handleOtherSearch({keyword:e.$route.query.keyword||"",scene:e.$route.query.scene||""}),t.next=18;break;case 15:return Object.keys(u).forEach((function(t){var a=u[t];if(a.sub==i){var r=a.children.find((function(e){return e.detail==n}))||{};r&&(r.name=a.name+"-"+r.name,e.category=r)}})),t.next=18,e.getMenuAchievements();case 18:e.$nextTick((function(){e.categoryHeight=document.querySelector("body").offsetHeight-document.querySelector(".m-info-top").offsetHeight})),e.loading=!1;case 20:case"end":return t.stop()}}),t)})))()},getMenuAchievements:function(){var e=this,t=this.category.sub,a=this.category.detail;Object(f["h"])(t,a).then((function(t){var a=t.data.data.achievements||[],i=[];a.forEach((function(e){i.push(e),e.SeriesAchievementList&&e.SeriesAchievementList.forEach((function(e,t){t>0&&i.push(e)}))})),e.handleRoleAchievements(i)}))},handleRoleAchievements:function(e){var t=this.compareRoles;e.map((function(e){for(var a=[],i=0;i<t.length;i++){var n=t[i];n.finishedAchievements.includes(String(e.ID))?a.push(!0):a.push(!1)}e.roles=a})),this.list=e,this.list_bak=Object(h["cloneDeep"])(e)}}},p=v,b=(a("5c62"),a("2877")),g=Object(b["a"])(p,i,n,!1,null,null,null);t["default"]=g.exports},e7d5:function(e,t,a){"use strict";a("83f1")}}]);